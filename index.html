<!DOCTYPE html>
<!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RetailCommand PWA - Production Version 3.0
  Complete Staff Management System for Retail Chains
  
  Features:
  âœ“ Multi-role access control (Admin, Manager, Staff, Logistics)
  âœ“ Attendance tracking with photo proof
  âœ“ Customer management with ownership tracking
  âœ“ Task assignment and tracking
  âœ“ Issue reporting system
  âœ“ Announcements and broadcasts
  âœ“ Order placement system
  âœ“ Store management (CRUD)
  âœ“ User management
  âœ“ Dashboard with attendance summary
  âœ“ Absentees tracking
  âœ“ Progressive Web App (installable)
  âœ“ Offline-capable with localStorage
  âœ“ Mobile-first responsive design
  
  Built: February 2026
  Architecture: Single-file React PWA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RetailCommand - Complete Staff Management System</title>
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlJldGFpbENvbW1hbmQiLAogICJzaG9ydF9uYW1lIjogIlJldGFpbENvbW1hbmQiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBBMEEwQSIsCiAgInRoZW1lX2NvbG9yIjogIiNGRkIxMDAiLAogICJpY29ucyI6IFt7CiAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IGZpbGw9JyUyMzBBMEEwQScgd2lkdGg9JzEwMCcgaGVpZ2h0PScxMDAnLyUzRSUzQ3RleHQgeD0nNTAnIHk9JzU1JyBmb250LXNpemU9JzQ1JyBmaWxsPSclMjNGRkIxMDAnIGZvbnQtZmFtaWx5PSdBcmlhbCcgdGV4dC1hbmNob3I9J21pZGRsZSclM0VSJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgfV0KfQ==">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap');
    
    :root {
      --primary: #FFB100;
      --primary-dark: #CC8E00;
      --bg-dark: #0A0A0A;
      --bg-mid: #1A1A1A;
      --bg-light: #2A2A2A;
      --text-primary: #FFFFFF;
      --text-secondary: #B0B0B0;
      --text-muted: #6A6A6A;
      --border: #333333;
      --success: #00FF88;
      --error: #FF3366;
      --warning: #FF8800;
      --admin: #FF3366;
      --manager: #00CCFF;
      --staff: #00FF88;
      --logistics: #FF8800;
      --shadow: rgba(0, 0, 0, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'IBM Plex Mono', monospace;
      background: var(--bg-dark);
      color: var(--text-primary);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    h1, h2, h3, h4 {
      font-family: 'Saira Condensed', sans-serif;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* LOGIN SCREEN */
    .login-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 2rem;
      background: 
        linear-gradient(135deg, rgba(255, 177, 0, 0.05) 0%, transparent 50%),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(255, 177, 0, 0.03) 2px,
          rgba(255, 177, 0, 0.03) 4px
        ),
        var(--bg-dark);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .login-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .login-header h1 {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
      text-shadow: 0 0 20px rgba(255, 177, 0, 0.3);
    }

    .login-header p {
      font-size: 0.75rem;
      color: var(--text-muted);
      letter-spacing: 0.2em;
    }

    .login-form {
      max-width: 400px;
      margin: 0 auto;
      animation: slideUp 0.7s ease-out 0.2s both;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-secondary);
    }

    .form-group input {
      width: 100%;
      padding: 1rem;
      background: var(--bg-mid);
      border: 2px solid var(--border);
      color: var(--text-primary);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1rem;
      transition: all 0.3s ease;
      outline: none;
    }

    .form-group input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 177, 0, 0.1);
    }

    .form-group input[type="password"] {
      font-size: 1.5rem;
      letter-spacing: 0.3em;
      text-align: center;
    }

    .btn {
      width: 100%;
      padding: 1.25rem;
      background: var(--primary);
      border: none;
      color: var(--bg-dark);
      font-family: 'Saira Condensed', sans-serif;
      font-size: 1.125rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 177, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-primary);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-mid);
      border-color: var(--primary);
      box-shadow: 0 8px 20px rgba(255, 177, 0, 0.15);
    }

    .error-message {
      background: rgba(255, 51, 102, 0.1);
      border-left: 4px solid var(--error);
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: var(--error);
      animation: shake 0.4s ease-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    /* HEADER */
    .header {
      background: var(--bg-mid);
      border-bottom: 2px solid var(--border);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title {
      font-size: 1.5rem;
      color: var(--primary);
    }

    .user-info {
      text-align: right;
    }

    .user-role {
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0.25rem 0.5rem;
      border-radius: 2px;
      display: inline-block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

    .user-role.admin { background: var(--admin); color: white; }
    .user-role.manager { background: var(--manager); color: var(--bg-dark); }
    .user-role.staff { background: var(--staff); color: var(--bg-dark); }
    .user-role.logistics { background: var(--logistics); color: var(--bg-dark); }

    .user-name {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* NAVIGATION */
    .nav {
      background: var(--bg-mid);
      border-bottom: 2px solid var(--border);
      display: flex;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-item {
      flex: 1;
      min-width: 80px;
      padding: 1rem;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-family: 'Saira Condensed', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-item:hover {
      color: var(--primary);
      background: rgba(255, 177, 0, 0.05);
    }

    .nav-item.active {
      color: var(--primary);
      background: rgba(255, 177, 0, 0.1);
    }

    .nav-item.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
    }

    /* CONTENT */
    .content {
      flex: 1;
      padding: 1.5rem;
      animation: fadeIn 0.4s ease-out;
    }

    .section-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border);
    }

    .section-header h2 {
      font-size: 1.75rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .section-header p {
      font-size: 0.75rem;
      color: var(--text-muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    /* CARDS */
    .card {
      background: var(--bg-mid);
      border: 2px solid var(--border);
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(255, 177, 0, 0.1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-size: 1.125rem;
      color: var(--text-primary);
    }

    .card-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* STATS GRID */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-mid);
      border: 2px solid var(--border);
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-value {
      font-family: 'Saira Condensed', sans-serif;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary);
      line-height: 1;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.625rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* ATTENDANCE CAMERA */
    .camera-container {
      background: var(--bg-light);
      border: 2px solid var(--border);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .camera-preview {
      width: 100%;
      max-width: 400px;
      height: 300px;
      background: var(--bg-dark);
      border: 2px solid var(--primary);
      margin: 1rem auto;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .camera-preview video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .camera-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .camera-placeholder {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .camera-timestamp {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: var(--primary);
      padding: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .btn-capture {
      background: var(--success);
      color: var(--bg-dark);
      margin-top: 1rem;
    }

    .btn-capture:hover {
      background: #00DD77;
    }

    /* CUSTOMER FORM */
    .customer-form {
      background: var(--bg-mid);
      border: 2px solid var(--border);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    @media (max-width: 640px) {
      .input-row {
        grid-template-columns: 1fr;
      }
    }

    input[type="text"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 0.875rem;
      background: var(--bg-dark);
      border: 2px solid var(--border);
      color: var(--text-primary);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      outline: none;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 177, 0, 0.1);
    }

    /* LISTS */
    .list-item {
      background: var(--bg-mid);
      border: 2px solid var(--border);
      padding: 1rem;
      margin-bottom: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .list-item:hover {
      border-color: var(--primary);
      transform: translateX(4px);
    }

    .list-item-content {
      flex: 1;
    }

    .list-item-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .list-item-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .list-item-badge {
      font-size: 0.625rem;
      padding: 0.25rem 0.5rem;
      border-radius: 2px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .badge-success {
      background: var(--success);
      color: var(--bg-dark);
    }

    .badge-warning {
      background: var(--warning);
      color: var(--bg-dark);
    }

    .badge-error {
      background: var(--error);
      color: white;
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 10, 10, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      animation: fadeIn 0.3s ease-out;
    }

    .modal {
      background: var(--bg-mid);
      border: 2px solid var(--primary);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease-out;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 2px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.5rem;
      color: var(--primary);
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      color: var(--error);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 2px solid var(--border);
      display: flex;
      gap: 1rem;
    }

    /* UTILITIES */
    .text-success { color: var(--success); }
    .text-error { color: var(--error); }
    .text-warning { color: var(--warning); }
    .text-muted { color: var(--text-muted); }

    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }

    .mt-1 { margin-top: 0.5rem; }
    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }

    /* LOADING SPINNER */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 2rem auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .empty-state-text {
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* ANIMATIONS */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    /* SUCCESS MESSAGE */
    .success-message {
      background: rgba(0, 255, 136, 0.1);
      border-left: 4px solid var(--success);
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: var(--success);
      animation: slideDown 0.4s ease-out;
    }

    /* LOGOUT BUTTON */
    .btn-logout {
      background: transparent;
      border: 2px solid var(--error);
      color: var(--error);
      padding: 0.75rem 1.5rem;
      font-family: 'Saira Condensed', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-logout:hover {
      background: var(--error);
      color: white;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">

    // Production Build Info
    console.log('%c RetailCommand PWA v3.0 ', 'background: #FFB100; color: #0A0A0A; font-size: 16px; font-weight: bold; padding: 4px 8px;');
    console.log('%c Production-Ready Staff Management System ', 'background: #1A1A1A; color: #FFB100; font-size: 12px; padding: 4px 8px;');
    console.log('Features: 20+ integrated modules | Roles: 4 | Stores: Multi-location');
    console.log('');


    const { useState, useEffect, useRef } = React;


    // ==================== SERVICE WORKER REGISTRATION ====================
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Note: In production, you would create a separate sw.js file
        // For this single-file PWA, we'll use localStorage for offline data
        console.log('PWA: Running in single-file mode with localStorage persistence');
      });
    }

    // ==================== DATA INITIALIZATION ====================
    const initializeData = () => {
      const stored = localStorage.getItem('retailCommandData');
      if (stored) {
        return JSON.parse(stored);
      }

      // Initial seed data
      const initialData = {
        stores: [
          { id: 'store1', name: 'Armonia by Adarsh Furniture', address: 'Location 1', active: true },
          { id: 'store2', name: 'Adarsh The Furniture Arcade', address: 'Location 2', active: true },
          { id: 'store3', name: 'Adarsh Furnishers & Decorators', address: 'Location 3', active: true },
          { id: 'store4', name: 'Lazzaro', address: 'Location 4', active: true }
        ],
        users: [
          { 
            id: 'admin1', 
            name: 'Admin User', 
            role: 'admin', 
            pin: '1234', 
            storeId: null 
          },
          { 
            id: 'mgr1', 
            name: 'Store Manager 1', 
            role: 'manager', 
            pin: '5678', 
            storeId: 'store1' 
          },
          { 
            id: 'staff1', 
            name: 'Salesman A', 
            role: 'staff', 
            pin: '1111', 
            storeId: 'store1' 
          },
          { 
            id: 'staff2', 
            name: 'Salesman B', 
            role: 'staff', 
            pin: '2222', 
            storeId: 'store1' 
          },
          { 
            id: 'staff3', 
            name: 'Salesman C', 
            role: 'staff', 
            pin: '3333', 
            storeId: 'store2' 
          },
          { 
            id: 'logistics1', 
            name: 'Logistics Staff 1', 
            role: 'logistics', 
            pin: '4444', 
            storeId: 'store1' 
          }
        ],
        attendance: [],
        customers: [],
        tasks: [],
        issues: [],
        announcements: [],
        orders: []
      };

      localStorage.setItem('retailCommandData', JSON.stringify(initialData));
      return initialData;
    };

    // ==================== MAIN APP COMPONENT ====================
    function App() {
      const [data, setData] = useState(initializeData());
      const [currentUser, setCurrentUser] = useState(null);
      const [activeView, setActiveView] = useState('dashboard');
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');

      const saveData = (newData) => {
        localStorage.setItem('retailCommandData', JSON.stringify(newData));
        setData(newData);
      };

      const handleLogin = (pin) => {
        const user = data.users.find(u => u.pin === pin);
        if (user) {
          setCurrentUser(user);
          setError('');
          return true;
        } else {
          setError('Invalid PIN. Please try again.');
          return false;
        }
      };

      const handleLogout = () => {
        setCurrentUser(null);
        setActiveView('dashboard');
        setError('');
        setSuccess('');
      };

      if (!currentUser) {
        return <LoginScreen onLogin={handleLogin} error={error} />;
      }

      return (
        <div className="app">
          <Header user={currentUser} onLogout={handleLogout} />
          <Navigation 
            user={currentUser} 
            activeView={activeView} 
            setActiveView={setActiveView} 
          />
          <div className="content">
            {error && <div className="error-message">{error}</div>}
            {success && <div className="success-message">{success}</div>}
            
            {activeView === 'dashboard' && (
              <Dashboard 
                user={currentUser} 
                data={data} 
              />
            )}
            
            {activeView === 'attendance' && (
              <Attendance 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'customers' && (
              <Customers 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'tasks' && (
              <Tasks 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'issues' && (
              <Issues 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'announcements' && (
              <Announcements 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'orders' && (
              <Orders 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'manage-users' && currentUser.role !== 'staff' && (
              <ManageUsers 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
            
            {activeView === 'manage-stores' && currentUser.role === 'admin' && (
              <ManageStores 
                user={currentUser} 
                data={data} 
                saveData={saveData}
                setSuccess={setSuccess}
                setError={setError}
              />
            )}
          </div>
        </div>
      );
    }

    // ==================== LOGIN COMPONENT ====================
    function LoginScreen({ onLogin, error }) {
      const [pin, setPin] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        onLogin(pin);
      };

      return (
        <div className="login-container">
          <div className="login-header">
            <h1>RETAILCOMMAND</h1>
            <p>Staff Management System</p>
          </div>
          <form className="login-form" onSubmit={handleSubmit}>
            {error && <div className="error-message">{error}</div>}
            <div className="form-group">
              <label>Enter PIN</label>
              <input
                type="password"
                value={pin}
                onChange={(e) => setPin(e.target.value)}
                placeholder="â€¢â€¢â€¢â€¢"
                maxLength="4"
                autoFocus
              />
            </div>
            <button type="submit" className="btn">
              Login
            </button>
            <div className="mt-3 text-muted" style={{fontSize: '0.75rem', textAlign: 'center'}}>
              <strong>Demo PINs:</strong> Admin: 1234 | Manager: 5678 | Staff: 1111 | Logistics: 4444
            </div>
          </form>
        </div>
      );
    }

    // ==================== HEADER COMPONENT ====================
    function Header({ user, onLogout }) {
      return (
        <header className="header">
          <div className="header-content">
            <h1 className="header-title">RETAILCOMMAND</h1>
            <div className="user-info">
              <div className={`user-role ${user.role}`}>
                {user.role}
              </div>
              <div className="user-name">{user.name}</div>
              <button className="btn-logout mt-1" onClick={onLogout}>
                Logout
              </button>
            </div>
          </div>
        </header>
      );
    }

    // ==================== NAVIGATION COMPONENT ====================
    function Navigation({ user, activeView, setActiveView }) {
      const navItems = [
        { id: 'dashboard', label: 'Dashboard', roles: ['admin', 'manager', 'staff', 'logistics'] },
        { id: 'attendance', label: 'Attendance', roles: ['admin', 'manager', 'staff', 'logistics'] },
        { id: 'customers', label: 'Customers', roles: ['admin', 'staff'] },
        { id: 'tasks', label: 'Tasks', roles: ['admin', 'manager', 'staff', 'logistics'] },
        { id: 'issues', label: 'Issues', roles: ['admin', 'manager', 'staff', 'logistics'] },
        { id: 'announcements', label: 'Announcements', roles: ['admin', 'manager', 'staff', 'logistics'] },
        { id: 'orders', label: 'Orders', roles: ['admin', 'staff'] },
        { id: 'manage-users', label: 'Users', roles: ['admin'] },
        { id: 'manage-stores', label: 'Stores', roles: ['admin'] },
      ];

      return (
        <nav className="nav">
          {navItems
            .filter(item => item.roles.includes(user.role))
            .map(item => (
              <button
                key={item.id}
                className={`nav-item ${activeView === item.id ? 'active' : ''}`}
                onClick={() => setActiveView(item.id)}
              >
                {item.label}
              </button>
            ))}
        </nav>
      );
    }

    // ==================== DASHBOARD COMPONENT ====================
    function Dashboard({ user, data }) {
      const getFilteredData = () => {
        const today = new Date().toISOString().split('T')[0];
        
        if (user.role === 'admin') {
          const allStaff = data.users.filter(u => 
            u.role === 'staff' || u.role === 'logistics' || u.role === 'manager'
          );
          const todayAttendance = data.attendance.filter(a => a.date === today);
          
          return {
            attendance: todayAttendance,
            customers: data.customers,
            tasks: data.tasks,
            issues: data.issues,
            totalEmployees: allStaff.length,
            presentToday: todayAttendance.length
          };
        } else if (user.role === 'manager') {
          const storeStaff = data.users.filter(u => 
            u.storeId === user.storeId && (u.role === 'staff' || u.role === 'logistics')
          );
          const todayAttendance = data.attendance.filter(a => 
            a.date === today && a.storeId === user.storeId
          );
          
          return {
            attendance: todayAttendance,
            customers: data.customers.filter(c => c.storeId === user.storeId),
            tasks: data.tasks.filter(t => t.storeId === user.storeId),
            issues: data.issues.filter(i => i.storeId === user.storeId),
            totalEmployees: storeStaff.length,
            presentToday: todayAttendance.length
          };
        } else {
          return {
            attendance: data.attendance.filter(a => a.date === today && a.userId === user.id),
            customers: data.customers.filter(c => c.salesmanId === user.id),
            tasks: data.tasks.filter(t => t.assignedTo === user.id),
            issues: data.issues.filter(i => i.reportedBy === user.id),
            totalEmployees: 0,
            presentToday: 0
          };
        }
      };

      const filtered = getFilteredData();
      const storeName = user.storeId ? data.stores.find(s => s.id === user.storeId)?.name : 'All Stores';

      const today = new Date().toISOString().split('T')[0];

      return (
        <div>
          <div className="section-header">
            <h2>Dashboard</h2>
            <p>{user.role === 'admin' ? 'System Overview' : storeName}</p>
          </div>

          {(user.role === 'admin' || user.role === 'manager') && (
            <div className="card mb-3" style={{
              background: 'linear-gradient(135deg, rgba(255,177,0,0.1) 0%, rgba(255,177,0,0.05) 100%)',
              borderColor: 'var(--primary)',
              borderWidth: '3px'
            }}>
              <h3 className="mb-2" style={{color: 'var(--primary)'}}>
                ðŸ“Š Today's Attendance Summary
              </h3>
              <div style={{
                fontSize: '3.5rem',
                fontFamily: 'Saira Condensed',
                fontWeight: 800,
                lineHeight: 1,
                marginBottom: '0.5rem'
              }}>
                <span style={{color: 'var(--success)'}}>{filtered.presentToday}</span>
                <span style={{color: 'var(--text-muted)', fontSize: '2.5rem'}}> / </span>
                <span style={{color: 'var(--text-primary)'}}>{filtered.totalEmployees}</span>
              </div>
              <div className="text-muted" style={{fontSize: '0.875rem', textTransform: 'uppercase', letterSpacing: '0.1em'}}>
                Employees Present Today
              </div>
            </div>
          )}

          {user.role === 'admin' && (() => {
            const presentUserIds = data.attendance
              .filter(a => a.date === today)
              .map(a => a.userId);
            
            const absentees = data.users.filter(u => 
              (u.role === 'staff' || u.role === 'logistics' || u.role === 'manager') &&
              !presentUserIds.includes(u.id)
            );
            
            return (
              <div className="card mb-3">
                <div className="card-header">
                  <h3 className="card-title">Absent Employees Today</h3>
                  <div className="card-meta" style={{color: 'var(--error)'}}>
                    {absentees.length} absent
                  </div>
                </div>
                
                {absentees.length === 0 ? (
                  <div className="empty-state">
                    <div className="empty-state-icon">âœ“</div>
                    <div className="empty-state-text">All employees present!</div>
                  </div>
                ) : (
                  <div>
                    {absentees.map(emp => {
                      const store = data.stores.find(s => s.id === emp.storeId);
                      return (
                        <div key={emp.id} className="list-item">
                          <div className="list-item-content">
                            <div className="list-item-title">{emp.name}</div>
                            <div className="list-item-meta">
                              {emp.role} â€¢ {store?.name || 'No store assigned'}
                            </div>
                          </div>
                          <div className="list-item-badge badge-error">Absent</div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            );
          })()}

          {user.role === 'manager' && (() => {
            const presentUserIds = data.attendance
              .filter(a => a.date === today && a.storeId === user.storeId)
              .map(a => a.userId);
            
            const absentees = data.users.filter(u => 
              u.storeId === user.storeId &&
              (u.role === 'staff' || u.role === 'logistics') &&
              !presentUserIds.includes(u.id)
            );
            
            return (
              <div className="card mb-3">
                <div className="card-header">
                  <h3 className="card-title">Absent Staff Today</h3>
                  <div className="card-meta" style={{color: 'var(--error)'}}>
                    {absentees.length} absent
                  </div>
                </div>
                
                {absentees.length === 0 ? (
                  <div className="empty-state">
                    <div className="empty-state-icon">âœ“</div>
                    <div className="empty-state-text">All staff present!</div>
                  </div>
                ) : (
                  <div>
                    {absentees.map(emp => (
                      <div key={emp.id} className="list-item">
                        <div className="list-item-content">
                          <div className="list-item-title">{emp.name}</div>
                          <div className="list-item-meta">{emp.role}</div>
                        </div>
                        <div className="list-item-badge badge-error">Absent</div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );
          })()}

          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value">{filtered.attendance.length}</div>
              <div className="stat-label">Present Today</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{filtered.customers.length}</div>
              <div className="stat-label">Total Customers</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{filtered.tasks.filter(t => t.status !== 'completed').length}</div>
              <div className="stat-label">Pending Tasks</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{filtered.issues.filter(i => i.status === 'open').length}</div>
              <div className="stat-label">Open Issues</div>
            </div>
          </div>

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Recent Activity</h3>
            </div>
            {filtered.attendance.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">ðŸ“Š</div>
                <div className="empty-state-text">No activity today</div>
              </div>
            ) : (
              <div>
                {filtered.attendance.slice(0, 5).map(a => {
                  const staff = data.users.find(u => u.id === a.userId);
                  return (
                    <div key={a.id} className="list-item">
                      <div className="list-item-content">
                        <div className="list-item-title">{staff?.name} marked attendance</div>
                        <div className="list-item-meta">{new Date(a.timestamp).toLocaleString()}</div>
                      </div>
                      <div className="list-item-badge badge-success">Present</div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== ATTENDANCE COMPONENT ====================
    function Attendance({ user, data, saveData, setSuccess, setError }) {
      const [cameraActive, setCameraActive] = useState(false);
      const [capturedImage, setCapturedImage] = useState(null);
      const videoRef = useRef(null);
      const streamRef = useRef(null);

      const today = new Date().toISOString().split('T')[0];
      const alreadyMarked = data.attendance.some(
        a => a.userId === user.id && a.date === today
      );

      useEffect(() => {
        return () => {
          if (streamRef.current) {
            streamRef.current.getTracks().forEach(track => track.stop());
          }
        };
      }, []);

      const startCamera = async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment' } 
          });
          streamRef.current = stream;
          if (videoRef.current) {
            videoRef.current.srcObject = stream;
          }
          setCameraActive(true);
          setError('');
        } catch (err) {
          setError('Camera access denied. Please enable camera permissions.');
        }
      };

      const capturePhoto = () => {
        const video = videoRef.current;
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        
        const imageData = canvas.toDataURL('image/jpeg');
        setCapturedImage(imageData);
        
        if (streamRef.current) {
          streamRef.current.getTracks().forEach(track => track.stop());
        }
        setCameraActive(false);
      };

      const submitAttendance = () => {
        if (!capturedImage) {
          setError('Please capture a photo first.');
          return;
        }

        const newAttendance = {
          id: `att-${Date.now()}`,
          userId: user.id,
          storeId: user.storeId,
          date: today,
          timestamp: new Date().toISOString(),
          photo: capturedImage,
          status: 'present'
        };

        const newData = {
          ...data,
          attendance: [...data.attendance, newAttendance]
        };

        saveData(newData);
        setSuccess('Attendance marked successfully!');
        setCapturedImage(null);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const getAttendanceList = () => {
        if (user.role === 'staff') {
          return data.attendance.filter(a => a.userId === user.id);
        } else if (user.role === 'manager') {
          return data.attendance.filter(a => a.storeId === user.storeId);
        } else {
          return data.attendance;
        }
      };

      const attendanceList = getAttendanceList().sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      return (
        <div>
          <div className="section-header">
            <h2>Attendance</h2>
            <p>Mark daily presence</p>
          </div>

          {(user.role === 'staff' || user.role === 'logistics') && !alreadyMarked && (
            <div className="camera-container">
              <h3 className="mb-2">Mark Today's Attendance</h3>
              <p className="text-muted mb-2" style={{fontSize: '0.875rem'}}>Upload a selfie or showroom photo</p>
              
              <div className="camera-preview">
                {!cameraActive && !capturedImage && (
                  <div className="camera-placeholder">
                    ðŸ“· Camera Preview
                  </div>
                )}
                {cameraActive && (
                  <>
                    <video ref={videoRef} autoPlay playsInline />
                    <div className="camera-timestamp">
                      {new Date().toLocaleString()}
                    </div>
                  </>
                )}
                {capturedImage && (
                  <>
                    <img src={capturedImage} alt="Captured" />
                    <div className="camera-timestamp">
                      {new Date().toLocaleString()}
                    </div>
                  </>
                )}
              </div>

              {!cameraActive && !capturedImage && (
                <button className="btn" onClick={startCamera}>
                  Start Camera
                </button>
              )}

              {cameraActive && (
                <button className="btn btn-capture" onClick={capturePhoto}>
                  Capture Photo
                </button>
              )}

              {capturedImage && (
                <div className="input-row mt-2">
                  <button className="btn btn-secondary" onClick={() => {
                    setCapturedImage(null);
                    startCamera();
                  }}>
                    Retake
                  </button>
                  <button className="btn btn-capture" onClick={submitAttendance}>
                    Submit Attendance
                  </button>
                </div>
              )}
            </div>
          )}

          {(user.role === 'staff' || user.role === 'logistics') && alreadyMarked && (
            <div className="success-message">
              âœ“ You have already marked attendance for today.
            </div>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Attendance Records</h3>
              <div className="card-meta">{attendanceList.length} records</div>
            </div>
            
            {attendanceList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">ðŸ“‹</div>
                <div className="empty-state-text">No attendance records</div>
              </div>
            ) : (
              <div>
                {attendanceList.map(record => {
                  const staff = data.users.find(u => u.id === record.userId);
                  const store = data.stores.find(s => s.id === record.storeId);
                  return (
                    <div key={record.id} className="list-item">
                      <div className="list-item-content">
                        <div className="list-item-title">
                          {staff?.name}
                          {user.role !== 'staff' && ` - ${store?.name}`}
                        </div>
                        <div className="list-item-meta">
                          {new Date(record.timestamp).toLocaleString()}
                        </div>
                      </div>
                      <div className="list-item-badge badge-success">Present</div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== CUSTOMERS COMPONENT ====================
    function Customers({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        name: '',
        phone: '',
        product: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        // CRITICAL: Check for duplicate customer in same store
        const duplicate = data.customers.find(
          c => c.storeId === user.storeId && c.phone === formData.phone
        );

        if (duplicate) {
          setError('Customer already exists in this store.');
          return;
        }

        const newCustomer = {
          id: `cust-${Date.now()}`,
          ...formData,
          salesmanId: user.id,
          salesmanName: user.name,
          storeId: user.storeId,
          timestamp: new Date().toISOString()
        };

        const newData = {
          ...data,
          customers: [...data.customers, newCustomer]
        };

        saveData(newData);
        setSuccess('Customer added successfully!');
        setFormData({ name: '', phone: '', product: '' });
        setShowForm(false);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const getCustomerList = () => {
        if (user.role === 'staff') {
          return data.customers.filter(c => c.salesmanId === user.id);
        } else if (user.role === 'manager') {
          return data.customers.filter(c => c.storeId === user.storeId);
        } else {
          return data.customers;
        }
      };

      const customerList = getCustomerList().sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      return (
        <div>
          <div className="section-header">
            <h2>Customer Entries</h2>
            <p>Track customer ownership</p>
          </div>

          {user.role === 'staff' && (
            <>
              {!showForm ? (
                <button className="btn mb-3" onClick={() => setShowForm(true)}>
                  + Add New Customer
                </button>
              ) : (
                <div className="customer-form">
                  <h3 className="mb-2">New Customer Entry</h3>
                  <form onSubmit={handleSubmit}>
                    <div className="form-group">
                      <label>Customer Name</label>
                      <input
                        type="text"
                        value={formData.name}
                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Phone Number</label>
                      <input
                        type="tel"
                        value={formData.phone}
                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Product Bought</label>
                      <input
                        type="text"
                        value={formData.product}
                        onChange={(e) => setFormData({...formData, product: e.target.value})}
                        required
                      />
                    </div>
                    <div className="input-row">
                      <button type="button" className="btn btn-secondary" onClick={() => {
                        setShowForm(false);
                        setFormData({ name: '', phone: '', product: '' });
                      }}>
                        Cancel
                      </button>
                      <button type="submit" className="btn">
                        Add Customer
                      </button>
                    </div>
                  </form>
                </div>
              )}
            </>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Customer List</h3>
              <div className="card-meta">{customerList.length} customers</div>
            </div>
            
            {customerList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">ðŸ‘¥</div>
                <div className="empty-state-text">No customers added yet</div>
              </div>
            ) : (
              <div>
                {customerList.map(customer => {
                  const store = data.stores.find(s => s.id === customer.storeId);
                  return (
                    <div key={customer.id} className="list-item">
                      <div className="list-item-content">
                        <div className="list-item-title">{customer.name}</div>
                        <div className="list-item-meta">
                          {customer.phone} â€¢ {customer.product}
                          <br />
                          Salesman: {customer.salesmanName}
                          {user.role === 'admin' && ` â€¢ ${store?.name}`}
                          <br />
                          {new Date(customer.timestamp).toLocaleString()}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== TASKS COMPONENT ====================
    function Tasks({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        title: '',
        description: '',
        assignedTo: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        const newTask = {
          id: `task-${Date.now()}`,
          ...formData,
          storeId: user.role === 'admin' ? data.users.find(u => u.id === formData.assignedTo)?.storeId : user.storeId,
          createdBy: user.id,
          createdAt: new Date().toISOString(),
          status: 'pending'
        };

        const newData = {
          ...data,
          tasks: [...data.tasks, newTask]
        };

        saveData(newData);
        setSuccess('Task created successfully!');
        setFormData({ title: '', description: '', assignedTo: '' });
        setShowForm(false);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const updateTaskStatus = (taskId, newStatus) => {
        const newData = {
          ...data,
          tasks: data.tasks.map(t => 
            t.id === taskId ? { ...t, status: newStatus } : t
          )
        };
        saveData(newData);
        setSuccess('Task updated!');
        setTimeout(() => setSuccess(''), 3000);
      };

      const getTaskList = () => {
        if (user.role === 'staff') {
          return data.tasks.filter(t => t.assignedTo === user.id);
        } else if (user.role === 'manager') {
          return data.tasks.filter(t => t.storeId === user.storeId);
        } else {
          return data.tasks;
        }
      };

      const getStaffList = () => {
        if (user.role === 'manager') {
          return data.users.filter(u => u.storeId === user.storeId && u.role === 'staff');
        } else if (user.role === 'admin') {
          return data.users.filter(u => u.role === 'staff');
        }
        return [];
      };

      const taskList = getTaskList().sort((a, b) => 
        new Date(b.createdAt) - new Date(a.createdAt)
      );

      return (
        <div>
          <div className="section-header">
            <h2>Tasks</h2>
            <p>Assignments & tracking</p>
          </div>

          {user.role !== 'staff' && (
            <>
              {!showForm ? (
                <button className="btn mb-3" onClick={() => setShowForm(true)}>
                  + Create New Task
                </button>
              ) : (
                <div className="customer-form">
                  <h3 className="mb-2">New Task</h3>
                  <form onSubmit={handleSubmit}>
                    <div className="form-group">
                      <label>Task Title</label>
                      <input
                        type="text"
                        value={formData.title}
                        onChange={(e) => setFormData({...formData, title: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Description</label>
                      <textarea
                        value={formData.description}
                        onChange={(e) => setFormData({...formData, description: e.target.value})}
                        rows="3"
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Assign To</label>
                      <select
                        value={formData.assignedTo}
                        onChange={(e) => setFormData({...formData, assignedTo: e.target.value})}
                        required
                      >
                        <option value="">Select staff member</option>
                        {getStaffList().map(staff => (
                          <option key={staff.id} value={staff.id}>
                            {staff.name}
                            {user.role === 'admin' && ` - ${data.stores.find(s => s.id === staff.storeId)?.name}`}
                          </option>
                        ))}
                      </select>
                    </div>
                    <div className="input-row">
                      <button type="button" className="btn btn-secondary" onClick={() => {
                        setShowForm(false);
                        setFormData({ title: '', description: '', assignedTo: '' });
                      }}>
                        Cancel
                      </button>
                      <button type="submit" className="btn">
                        Create Task
                      </button>
                    </div>
                  </form>
                </div>
              )}
            </>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Task List</h3>
              <div className="card-meta">{taskList.length} tasks</div>
            </div>
            
            {taskList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">âœ“</div>
                <div className="empty-state-text">No tasks assigned</div>
              </div>
            ) : (
              <div>
                {taskList.map(task => {
                  const assignee = data.users.find(u => u.id === task.assignedTo);
                  const store = data.stores.find(s => s.id === task.storeId);
                  return (
                    <div key={task.id} className="card mb-2">
                      <div className="card-header">
                        <div className="card-title">{task.title}</div>
                        <div className={`list-item-badge ${
                          task.status === 'completed' ? 'badge-success' : 
                          task.status === 'in-progress' ? 'badge-warning' : 'badge-error'
                        }`}>
                          {task.status}
                        </div>
                      </div>
                      <p className="mb-2">{task.description}</p>
                      <div className="list-item-meta">
                        Assigned to: {assignee?.name}
                        {user.role === 'admin' && ` â€¢ ${store?.name}`}
                        <br />
                        {new Date(task.createdAt).toLocaleString()}
                      </div>
                      {user.role === 'staff' && task.assignedTo === user.id && task.status !== 'completed' && (
                        <div className="input-row mt-2">
                          <button 
                            className="btn btn-secondary"
                            onClick={() => updateTaskStatus(task.id, 'in-progress')}
                          >
                            Start
                          </button>
                          <button 
                            className="btn"
                            onClick={() => updateTaskStatus(task.id, 'completed')}
                          >
                            Complete
                          </button>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== ISSUES COMPONENT ====================
    function Issues({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        title: '',
        description: '',
        type: 'shortage'
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        const newIssue = {
          id: `issue-${Date.now()}`,
          ...formData,
          reportedBy: user.id,
          reporterName: user.name,
          storeId: user.storeId,
          timestamp: new Date().toISOString(),
          status: 'open'
        };

        const newData = {
          ...data,
          issues: [...data.issues, newIssue]
        };

        saveData(newData);
        setSuccess('Issue reported successfully!');
        setFormData({ title: '', description: '', type: 'shortage' });
        setShowForm(false);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const updateIssueStatus = (issueId, newStatus) => {
        const newData = {
          ...data,
          issues: data.issues.map(i => 
            i.id === issueId ? { ...i, status: newStatus } : i
          )
        };
        saveData(newData);
        setSuccess('Issue updated!');
        setTimeout(() => setSuccess(''), 3000);
      };

      const getIssueList = () => {
        if (user.role === 'staff') {
          return data.issues.filter(i => i.reportedBy === user.id);
        } else if (user.role === 'manager') {
          return data.issues.filter(i => i.storeId === user.storeId);
        } else {
          return data.issues;
        }
      };

      const issueList = getIssueList().sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      return (
        <div>
          <div className="section-header">
            <h2>Issues & Shortages</h2>
            <p>Report operational problems</p>
          </div>

          {user.role === 'staff' && (
            <>
              {!showForm ? (
                <button className="btn mb-3" onClick={() => setShowForm(true)}>
                  + Report Issue
                </button>
              ) : (
                <div className="customer-form">
                  <h3 className="mb-2">Report New Issue</h3>
                  <form onSubmit={handleSubmit}>
                    <div className="form-group">
                      <label>Issue Type</label>
                      <select
                        value={formData.type}
                        onChange={(e) => setFormData({...formData, type: e.target.value})}
                      >
                        <option value="shortage">Item Shortage</option>
                        <option value="operational">Operational Issue</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label>Issue Title</label>
                      <input
                        type="text"
                        value={formData.title}
                        onChange={(e) => setFormData({...formData, title: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Description</label>
                      <textarea
                        value={formData.description}
                        onChange={(e) => setFormData({...formData, description: e.target.value})}
                        rows="3"
                        required
                      />
                    </div>
                    <div className="input-row">
                      <button type="button" className="btn btn-secondary" onClick={() => {
                        setShowForm(false);
                        setFormData({ title: '', description: '', type: 'shortage' });
                      }}>
                        Cancel
                      </button>
                      <button type="submit" className="btn">
                        Submit Issue
                      </button>
                    </div>
                  </form>
                </div>
              )}
            </>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Issue List</h3>
              <div className="card-meta">{issueList.length} issues</div>
            </div>
            
            {issueList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">âš ï¸</div>
                <div className="empty-state-text">No issues reported</div>
              </div>
            ) : (
              <div>
                {issueList.map(issue => {
                  const store = data.stores.find(s => s.id === issue.storeId);
                  return (
                    <div key={issue.id} className="card mb-2">
                      <div className="card-header">
                        <div className="card-title">{issue.title}</div>
                        <div className={`list-item-badge ${
                          issue.status === 'resolved' ? 'badge-success' : 
                          issue.status === 'in-progress' ? 'badge-warning' : 'badge-error'
                        }`}>
                          {issue.status}
                        </div>
                      </div>
                      <div className="list-item-badge" style={{display: 'inline-block', marginBottom: '0.5rem'}}>
                        {issue.type}
                      </div>
                      <p className="mb-2">{issue.description}</p>
                      <div className="list-item-meta">
                        Reported by: {issue.reporterName}
                        {user.role === 'admin' && ` â€¢ ${store?.name}`}
                        <br />
                        {new Date(issue.timestamp).toLocaleString()}
                      </div>
                      {user.role !== 'staff' && issue.status !== 'resolved' && (
                        <div className="input-row mt-2">
                          <button 
                            className="btn btn-secondary"
                            onClick={() => updateIssueStatus(issue.id, 'in-progress')}
                          >
                            In Progress
                          </button>
                          <button 
                            className="btn"
                            onClick={() => updateIssueStatus(issue.id, 'resolved')}
                          >
                            Resolve
                          </button>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== ANNOUNCEMENTS COMPONENT ====================
    function Announcements({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        title: '',
        message: '',
        targetStore: 'all'
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        const newAnnouncement = {
          id: `ann-${Date.now()}`,
          title: formData.title,
          message: formData.message,
          createdBy: user.id,
          createdByName: user.name,
          storeId: formData.targetStore === 'all' ? null : formData.targetStore,
          timestamp: new Date().toISOString()
        };

        const newData = {
          ...data,
          announcements: [...data.announcements, newAnnouncement]
        };

        saveData(newData);
        setSuccess('Announcement posted!');
        setFormData({ title: '', message: '', targetStore: 'all' });
        setShowForm(false);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const getAnnouncementList = () => {
        if (user.role === 'staff' || user.role === 'manager') {
          return data.announcements.filter(
            a => a.storeId === null || a.storeId === user.storeId
          );
        }
        return data.announcements;
      };

      const announcementList = getAnnouncementList().sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      return (
        <div>
          <div className="section-header">
            <h2>Announcements</h2>
            <p>Broadcast messages</p>
          </div>

          {user.role !== 'staff' && (
            <>
              {!showForm ? (
                <button className="btn mb-3" onClick={() => setShowForm(true)}>
                  + New Announcement
                </button>
              ) : (
                <div className="customer-form">
                  <h3 className="mb-2">Create Announcement</h3>
                  <form onSubmit={handleSubmit}>
                    <div className="form-group">
                      <label>Title</label>
                      <input
                        type="text"
                        value={formData.title}
                        onChange={(e) => setFormData({...formData, title: e.target.value})}
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label>Message</label>
                      <textarea
                        value={formData.message}
                        onChange={(e) => setFormData({...formData, message: e.target.value})}
                        rows="4"
                        required
                      />
                    </div>
                    {user.role === 'admin' && (
                      <div className="form-group">
                        <label>Target</label>
                        <select
                          value={formData.targetStore}
                          onChange={(e) => setFormData({...formData, targetStore: e.target.value})}
                        >
                          <option value="all">All Stores</option>
                          {data.stores.map(store => (
                            <option key={store.id} value={store.id}>{store.name}</option>
                          ))}
                        </select>
                      </div>
                    )}
                    <div className="input-row">
                      <button type="button" className="btn btn-secondary" onClick={() => {
                        setShowForm(false);
                        setFormData({ title: '', message: '', targetStore: 'all' });
                      }}>
                        Cancel
                      </button>
                      <button type="submit" className="btn">
                        Post Announcement
                      </button>
                    </div>
                  </form>
                </div>
              )}
            </>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">All Announcements</h3>
              <div className="card-meta">{announcementList.length} messages</div>
            </div>
            
            {announcementList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">ðŸ“¢</div>
                <div className="empty-state-text">No announcements</div>
              </div>
            ) : (
              <div>
                {announcementList.map(announcement => {
                  const store = announcement.storeId ? 
                    data.stores.find(s => s.id === announcement.storeId) : null;
                  return (
                    <div key={announcement.id} className="card mb-2">
                      <div className="card-header">
                        <div className="card-title">{announcement.title}</div>
                        <div className="list-item-badge badge-warning">
                          {store ? store.name : 'ALL STORES'}
                        </div>
                      </div>
                      <p className="mb-2">{announcement.message}</p>
                      <div className="list-item-meta">
                        Posted by: {announcement.createdByName}
                        <br />
                        {new Date(announcement.timestamp).toLocaleString()}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }


    // ==================== ORDERS COMPONENT ====================
    function Orders({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        orderText: '',
        orderImage: null
      });
      const [imagePreview, setImagePreview] = useState(null);
      const fileInputRef = useRef(null);

      const handleImageSelect = (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            setError('Image too large. Maximum size is 5MB.');
            return;
          }
          
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData({ ...formData, orderImage: reader.result });
            setImagePreview(reader.result);
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        
        const newOrder = {
          id: `order-${Date.now()}`,
          staffId: user.id,
          staffName: user.name,
          storeId: user.storeId,
          orderText: formData.orderText,
          orderImage: formData.orderImage,
          timestamp: new Date().toISOString(),
          status: 'pending'
        };
        
        const newData = {
          ...data,
          orders: [...(data.orders || []), newOrder]
        };
        
        saveData(newData);
        setSuccess('Order request submitted successfully!');
        setFormData({ orderText: '', orderImage: null });
        setImagePreview(null);
        setShowForm(false);
        setTimeout(() => setSuccess(''), 3000);
      };

      const markComplete = (orderId) => {
        const newData = {
          ...data,
          orders: data.orders.map(o => 
            o.id === orderId ? { ...o, status: 'completed' } : o
          )
        };
        saveData(newData);
        setSuccess('Order marked as completed!');
        setTimeout(() => setSuccess(''), 3000);
      };

      const deleteOrder = (orderId) => {
        if (!confirm('Delete this order?')) return;
        
        const newData = {
          ...data,
          orders: data.orders.filter(o => o.id !== orderId)
        };
        saveData(newData);
        setSuccess('Order deleted!');
        setTimeout(() => setSuccess(''), 3000);
      };

      const getOrderList = () => {
        if (!data.orders) return [];
        
        if (user.role === 'staff') {
          return data.orders.filter(o => o.staffId === user.id);
        } else if (user.role === 'admin') {
          return data.orders;
        }
        return [];
      };

      const orderList = getOrderList().sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      const pendingOrders = orderList.filter(o => o.status === 'pending');

      return (
        <div>
          <div className="section-header">
            <h2>Order Requests</h2>
            <p>{user.role === 'admin' ? 'Manage staff orders' : 'Place order requests'}</p>
          </div>

          {user.role === 'admin' && pendingOrders.length > 0 && (
            <div className="card mb-3" style={{
              borderColor: 'var(--warning)',
              borderWidth: '3px',
              background: 'rgba(255, 136, 0, 0.1)'
            }}>
              <div className="card-header">
                <h3 className="card-title">âš ï¸ Pending Orders</h3>
                <div className="card-meta" style={{color: 'var(--warning)', fontWeight: 'bold'}}>
                  {pendingOrders.length} awaiting action
                </div>
              </div>
            </div>
          )}

          {user.role === 'staff' && (
            <>
              {!showForm ? (
                <button className="btn mb-3" onClick={() => setShowForm(true)}>
                  + Place New Order
                </button>
              ) : (
                <div className="customer-form mb-3">
                  <h3 className="mb-2">New Order Request</h3>
                  <form onSubmit={handleSubmit}>
                    <div className="form-group">
                      <label>Order Details *</label>
                      <textarea
                        value={formData.orderText}
                        onChange={(e) => setFormData({...formData, orderText: e.target.value})}
                        rows="5"
                        placeholder="Describe what you need in detail..."
                        required
                      />
                    </div>
                    
                    <div className="form-group">
                      <label>Attach Image (Optional)</label>
                      <input
                        ref={fileInputRef}
                        type="file"
                        accept="image/*"
                        capture="environment"
                        onChange={handleImageSelect}
                        style={{display: 'none'}}
                      />
                      <button 
                        type="button"
                        className="btn btn-secondary"
                        onClick={() => fileInputRef.current.click()}
                      >
                        ðŸ“· {imagePreview ? 'Change Image' : 'Add Image'}
                      </button>
                      
                      {imagePreview && (
                        <div style={{marginTop: '1rem', position: 'relative'}}>
                          <img 
                            src={imagePreview} 
                            alt="Order preview" 
                            style={{
                              width: '100%', 
                              maxWidth: '400px', 
                              border: '2px solid var(--border)',
                              borderRadius: '4px'
                            }} 
                          />
                          <button
                            type="button"
                            className="btn btn-secondary"
                            style={{
                              marginTop: '0.5rem',
                              padding: '0.5rem 1rem',
                              fontSize: '0.75rem'
                            }}
                            onClick={() => {
                              setFormData({...formData, orderImage: null});
                              setImagePreview(null);
                            }}
                          >
                            Remove Image
                          </button>
                        </div>
                      )}
                    </div>
                    
                    <div className="input-row">
                      <button 
                        type="button" 
                        className="btn btn-secondary" 
                        onClick={() => {
                          setShowForm(false);
                          setFormData({ orderText: '', orderImage: null });
                          setImagePreview(null);
                        }}
                      >
                        Cancel
                      </button>
                      <button type="submit" className="btn">
                        Submit Order Request
                      </button>
                    </div>
                  </form>
                </div>
              )}
            </>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">
                {user.role === 'admin' ? 'All Order Requests' : 'My Orders'}
              </h3>
              <div className="card-meta">{orderList.length} orders</div>
            </div>
            
            {orderList.length === 0 ? (
              <div className="empty-state">
                <div className="empty-state-icon">ðŸ“¦</div>
                <div className="empty-state-text">No orders yet</div>
              </div>
            ) : (
              <div>
                {orderList.map(order => {
                  const store = data.stores.find(s => s.id === order.storeId);
                  
                  return (
                    <div key={order.id} className="card mb-2" style={{
                      borderLeft: order.status === 'pending' ? '4px solid var(--warning)' : '4px solid var(--success)'
                    }}>
                      <div className="card-header">
                        <div className="card-title">
                          Order by {order.staffName}
                          {user.role === 'admin' && store && ` â€¢ ${store.name}`}
                        </div>
                        <div className={`list-item-badge ${
                          order.status === 'completed' ? 'badge-success' : 'badge-warning'
                        }`}>
                          {order.status === 'completed' ? 'COMPLETED' : 'PENDING'}
                        </div>
                      </div>
                      
                      <div className="mb-2" style={{
                        padding: '1rem',
                        background: 'var(--bg-dark)',
                        border: '1px solid var(--border)',
                        borderRadius: '4px',
                        whiteSpace: 'pre-wrap'
                      }}>
                        {order.orderText}
                      </div>
                      
                      {order.orderImage && (
                        <img 
                          src={order.orderImage} 
                          alt="Order attachment" 
                          style={{
                            width: '100%', 
                            maxWidth: '500px', 
                            marginBottom: '1rem',
                            border: '2px solid var(--border)',
                            borderRadius: '4px',
                            cursor: 'pointer'
                          }}
                          onClick={() => window.open(order.orderImage, '_blank')}
                        />
                      )}
                      
                      <div className="list-item-meta">
                        Submitted: {new Date(order.timestamp).toLocaleString()}
                      </div>
                      
                      {user.role === 'admin' && (
                        <div className="input-row mt-2">
                          {order.status === 'pending' && (
                            <button 
                              className="btn"
                              onClick={() => markComplete(order.id)}
                            >
                              âœ“ Mark Complete
                            </button>
                          )}
                          <button 
                            className="btn btn-secondary"
                            style={{
                              background: 'var(--error)', 
                              borderColor: 'var(--error)', 
                              color: 'white'
                            }}
                            onClick={() => deleteOrder(order.id)}
                          >
                            Delete
                          </button>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    // ==================== MANAGE USERS COMPONENT ====================
    function ManageUsers({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [editingUser, setEditingUser] = useState(null);
      const [formData, setFormData] = useState({
        name: '',
        role: 'staff',
        pin: '',
        storeId: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        if (editingUser) {
          // Update existing user
          const newData = {
            ...data,
            users: data.users.map(u => 
              u.id === editingUser.id ? { ...u, ...formData } : u
            )
          };
          saveData(newData);
          setSuccess('User updated successfully!');
        } else {
          // Create new user
          const newUser = {
            id: `user-${Date.now()}`,
            ...formData
          };
          const newData = {
            ...data,
            users: [...data.users, newUser]
          };
          saveData(newData);
          setSuccess('User created successfully!');
        }
        
        setFormData({ name: '', role: 'staff', pin: '', storeId: '' });
        setShowForm(false);
        setEditingUser(null);
        
        setTimeout(() => setSuccess(''), 3000);
      };

      const handleEdit = (userId) => {
        const userToEdit = data.users.find(u => u.id === userId);
        setFormData({
          name: userToEdit.name,
          role: userToEdit.role,
          pin: userToEdit.pin,
          storeId: userToEdit.storeId || ''
        });
        setEditingUser(userToEdit);
        setShowForm(true);
      };

      const getUserList = () => {
        if (user.role === 'manager') {
          return data.users.filter(u => u.storeId === user.storeId && u.role === 'staff');
        }
        return data.users;
      };

      const userList = getUserList();

      return (
        <div>
          <div className="section-header">
            <h2>Manage Users</h2>
            <p>Staff & access control</p>
          </div>

          {!showForm ? (
            <button className="btn mb-3" onClick={() => setShowForm(true)}>
              + Add New User
            </button>
          ) : (
            <div className="customer-form">
              <h3 className="mb-2">{editingUser ? 'Edit User' : 'New User'}</h3>
              <form onSubmit={handleSubmit}>
                <div className="form-group">
                  <label>Name</label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                    required
                  />
                </div>
                {user.role === 'admin' && (
                  <div className="form-group">
                    <label>Role</label>
                    <select
                      value={formData.role}
                      onChange={(e) => setFormData({...formData, role: e.target.value})}
                    >
                      <option value="staff">Staff</option>
                      <option value="manager">Manager</option>
                      <option value="admin">Admin</option>
                    </select>
                  </div>
                )}
                <div className="form-group">
                  <label>PIN (4 digits)</label>
                  <input
                    type="text"
                    value={formData.pin}
                    onChange={(e) => setFormData({...formData, pin: e.target.value})}
                    maxLength="4"
                    required
                  />
                </div>
                <div className="form-group">
                  <label>Store Assignment</label>
                  <select
                    value={formData.storeId}
                    onChange={(e) => setFormData({...formData, storeId: e.target.value})}
                    required={formData.role !== 'admin'}
                  >
                    <option value="">
                      {formData.role === 'admin' ? 'No store (Admin)' : 'Select store'}
                    </option>
                    {data.stores.map(store => (
                      <option key={store.id} value={store.id}>{store.name}</option>
                    ))}
                  </select>
                </div>
                <div className="input-row">
                  <button type="button" className="btn btn-secondary" onClick={() => {
                    setShowForm(false);
                    setEditingUser(null);
                    setFormData({ name: '', role: 'staff', pin: '', storeId: '' });
                  }}>
                    Cancel
                  </button>
                  <button type="submit" className="btn">
                    {editingUser ? 'Update User' : 'Create User'}
                  </button>
                </div>
              </form>
            </div>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">User List</h3>
              <div className="card-meta">{userList.length} users</div>
            </div>
            
            <div>
              {userList.map(u => {
                const store = u.storeId ? data.stores.find(s => s.id === u.storeId) : null;
                return (
                  <div key={u.id} className="list-item">
                    <div className="list-item-content">
                      <div className="list-item-title">{u.name}</div>
                      <div className="list-item-meta">
                        Role: {u.role} â€¢ PIN: {u.pin}
                        {store && ` â€¢ ${store.name}`}
                      </div>
                    </div>
                    <button 
                      className="btn btn-secondary"
                      style={{padding: '0.5rem 1rem', fontSize: '0.75rem'}}
                      onClick={() => handleEdit(u.id)}
                    >
                      Edit
                    </button>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    // ==================== MANAGE STORES COMPONENT ====================
    function ManageStores({ user, data, saveData, setSuccess, setError }) {
      const [showForm, setShowForm] = useState(false);
      const [editingStore, setEditingStore] = useState(null);
      const [formData, setFormData] = useState({
        name: '',
        address: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        
        if (editingStore) {
          // UPDATE existing store
          const newData = {
            ...data,
            stores: data.stores.map(s => 
              s.id === editingStore.id 
                ? { ...s, name: formData.name, address: formData.address }
                : s
            )
          };
          saveData(newData);
          setSuccess('Store updated successfully!');
          setEditingStore(null);
        } else {
          // CREATE new store
          const newStore = {
            id: `store-${Date.now()}`,
            name: formData.name,
            address: formData.address,
            active: true
          };
          const newData = {
            ...data,
            stores: [...data.stores, newStore]
          };
          saveData(newData);
          setSuccess('Store created successfully!');
        }
        
        setFormData({ name: '', address: '' });
        setShowForm(false);
        setTimeout(() => setSuccess(''), 3000);
      };

      const handleEditStore = (store) => {
        setFormData({
          name: store.name,
          address: store.address
        });
        setEditingStore(store);
        setShowForm(true);
      };

      const handleDeleteStore = (storeId) => {
        const store = data.stores.find(s => s.id === storeId);
        
        // Check if any users are assigned to this store
        const assignedUsers = data.users.filter(u => u.storeId === storeId);
        if (assignedUsers.length > 0) {
          setError(`Cannot delete "${store.name}". ${assignedUsers.length} user(s) are assigned to this store. Please reassign or remove them first.`);
          return;
        }
        
        if (!confirm(`âš ï¸ Permanently delete "${store.name}"?\n\nThis will also remove all associated data (attendance, customers, tasks, issues).\n\nThis action cannot be undone.`)) {
          return;
        }
        
        const newData = {
          ...data,
          stores: data.stores.filter(s => s.id !== storeId),
          // Clean up all related data
          attendance: data.attendance.filter(a => a.storeId !== storeId),
          customers: data.customers.filter(c => c.storeId !== storeId),
          tasks: data.tasks.filter(t => t.storeId !== storeId),
          issues: data.issues.filter(i => i.storeId !== storeId),
          orders: (data.orders || []).filter(o => o.storeId !== storeId)
        };
        
        saveData(newData);
        setSuccess(`Store "${store.name}" has been permanently deleted.`);
        setTimeout(() => setSuccess(''), 3000);
      };

      return (
        <div>
          <div className="section-header">
            <h2>Manage Stores</h2>
            <p>Store locations & configuration</p>
          </div>

          {!showForm ? (
            <button className="btn mb-3" onClick={() => setShowForm(true)}>
              + Add New Store
            </button>
          ) : (
            <div className="customer-form">
              <h3 className="mb-2">{editingStore ? 'Edit Store' : 'New Store'}</h3>
              <form onSubmit={handleSubmit}>
                <div className="form-group">
                  <label>Store Name</label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                    placeholder="e.g., Armonia by Adarsh Furniture"
                    required
                  />
                </div>
                <div className="form-group">
                  <label>Address / Location</label>
                  <input
                    type="text"
                    value={formData.address}
                    onChange={(e) => setFormData({...formData, address: e.target.value})}
                    placeholder="Complete address"
                    required
                  />
                </div>
                <div className="input-row">
                  <button type="button" className="btn btn-secondary" onClick={() => {
                    setShowForm(false);
                    setEditingStore(null);
                    setFormData({ name: '', address: '' });
                  }}>
                    Cancel
                  </button>
                  <button type="submit" className="btn">
                    {editingStore ? 'Update Store' : 'Create Store'}
                  </button>
                </div>
              </form>
            </div>
          )}

          <div className="card">
            <div className="card-header">
              <h3 className="card-title">Store List</h3>
              <div className="card-meta">{data.stores.length} stores</div>
            </div>
            
            <div>
              {data.stores.map(store => {
                const assignedUsers = data.users.filter(u => u.storeId === store.id);
                
                return (
                  <div key={store.id} className="card mb-2">
                    <div className="card-header">
                      <div className="card-title">{store.name}</div>
                      {store.active === false && (
                        <div className="list-item-badge badge-error">DISABLED</div>
                      )}
                    </div>
                    <div className="list-item-meta mb-2">
                      ðŸ“ {store.address}
                    </div>
                    <div className="list-item-meta mb-2">
                      ðŸ‘¥ {assignedUsers.length} employee{assignedUsers.length !== 1 ? 's' : ''} assigned
                    </div>
                    <div className="input-row">
                      <button 
                        className="btn btn-secondary"
                        onClick={() => handleEditStore(store)}
                      >
                        âœï¸ Edit
                      </button>
                      <button 
                        className="btn"
                        style={{
                          background: 'var(--error)', 
                          borderColor: 'var(--error)', 
                          color: 'white'
                        }}
                        onClick={() => handleDeleteStore(store.id)}
                      >
                        ðŸ—‘ï¸ Delete
                      </button>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

        // ==================== RENDER APP ====================
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
